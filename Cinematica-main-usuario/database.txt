DROP DATABASE IF EXISTS Cinematica;
CREATE DATABASE Cinematica;
USE Cinematica;

CREATE TABLE Empresa (
    nombreEmpresa varchar(50),
    email varchar(50),
    numeroTelefono int,
    calle varchar(50),
    numeroPuerta varchar(10),
    localidad varchar(50),
    PRIMARY KEY (nombreEmpresa)
);

CREATE TABLE redesSociales (
    nombreEmpresa varchar(50),
    redSocial varchar(20),
    urlRS varchar(250),
    logo varchar(1000),
    FOREIGN KEY (nombreEmpresa) REFERENCES Empresa(nombreEmpresa),
    PRIMARY KEY (nombreEmpresa, redSocial)
);

CREATE TABLE Usuario (
    email varchar(50),
    nombre varchar(20),
    apellido varchar(20),
    imagenPerfil varchar(50),
    passwd varchar(50),
    token varchar(50),
    numeroCelular int,
    PRIMARY KEY (email)
);

CREATE TABLE Administrador (
    email varchar(50),
    esAdmin boolean,
    nombreEmpresa varchar(50),
    FOREIGN KEY (email) REFERENCES Usuario(email),
    FOREIGN KEY (nombreEmpresa) REFERENCES Empresa(nombreEmpresa),
    PRIMARY KEY (email)
);

CREATE TABLE Cliente (
    email varchar(50),
    numeroTarjeta int,
    FOREIGN KEY (email) REFERENCES Usuario(email),
    PRIMARY KEY (email)
);

CREATE TABLE Producto (
    idProducto int,
    PRIMARY KEY (idProducto)
);

CREATE TABLE Pelicula (
    idProducto int,
    actores varchar(250),
    sinopsis varchar(250),
    duracion time,
    nombrePelicula varchar(40),
    pegi varchar(7),
    trailer varchar(250),
    director varchar(50),
    poster varchar(50),
    cabecera varchar(50),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (idProducto)
);

CREATE TABLE Articulo (
    idProducto int,
    nombreArticulo varchar(40),
    descripcion varchar(250),
    precio int,
    imagen varchar(50),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (idProducto)
);

CREATE TABLE Cine (
    nombreCine varchar(20),
    calle varchar(50),
    numeroPuerta varchar(10),
    localidad varchar(50),
    nombreEmpresa varchar(50),
    FOREIGN KEY (nombreEmpresa) REFERENCES Empresa(nombreEmpresa),
    PRIMARY KEY (nombreCine)
);

CREATE TABLE Sala (
    nombreCine varchar(20),
    numeroSala int,
    FOREIGN KEY (nombreCine) REFERENCES Cine(nombreCine),
    PRIMARY KEY (nombreCine, numeroSala)
);

CREATE TABLE Funciones (
    idFuncion int,
    idProducto int,
    nombreCine varchar(20),
    numeroSala int,
    fechaPelicula datetime,
    butacasOcupadas varchar(250),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    FOREIGN KEY (nombreCine, numeroSala) REFERENCES Sala(nombreCine, numeroSala),
    PRIMARY KEY (idFuncion)
);

CREATE TABLE Dimensiones (
    dimension varchar(2),
    precio int,
    PRIMARY KEY (dimension)
);

CREATE TABLE Compra (
    idCompra int,
    email varchar(50),
    idPelicula int,
    idFuncion int,
    dimension varchar(2),
    fechaCompra date,
    asientos varchar(50),
    precio int,
    FOREIGN KEY (email) REFERENCES Usuario(email),
    FOREIGN KEY (idPelicula) REFERENCES Producto(idProducto),
    FOREIGN KEY (idFuncion) REFERENCES Funciones(idFuncion),
    FOREIGN KEY (dimension) REFERENCES Dimensiones(dimension),
    PRIMARY KEY (idCompra)
);

CREATE TABLE CompraArticulo (
    idCompra int,
    idProducto int,
    cantidad int,
    FOREIGN KEY (idCompra) REFERENCES Compra(idCompra),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (idCompra, idProducto)
);

CREATE TABLE Carrito (
    email varchar(50),
    idPelicula int,
    idFuncion int,
    dimension varchar(2),
    asientos varchar(50),
    FOREIGN KEY (email) REFERENCES Usuario(email),
    FOREIGN KEY (idPelicula) REFERENCES Producto(idProducto),
    FOREIGN KEY (idFuncion) REFERENCES Funciones(idFuncion),
    FOREIGN KEY (dimension) REFERENCES Dimensiones(dimension)
);

CREATE TABLE CarritoArticulo (
    email varchar(50),
    idProducto int,
    cantidad int,
    FOREIGN KEY (email) REFERENCES Usuario(email),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto)
);

CREATE TABLE Idiomas (
    idioma varchar(20),
    PRIMARY KEY (idioma)
);

CREATE TABLE Categorias (
    nombreCategoria varchar(20),
    PRIMARY KEY (nombreCategoria)
);

CREATE TABLE TieneIdiomas (
    idioma varchar(20),
    idProducto int,
    FOREIGN KEY (idioma) REFERENCES Idiomas(idioma),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (idioma, idProducto)
);

CREATE TABLE TieneCategorias (
    nombreCategoria varchar(20),
    idProducto int,
    FOREIGN KEY (nombreCategoria) REFERENCES Categorias(nombreCategoria),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (nombreCategoria, idProducto)
);

CREATE TABLE TieneDimensiones (
    dimension varchar(2),
    idProducto int,
    FOREIGN KEY (dimension) REFERENCES Dimensiones(dimension),
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (dimension, idProducto)
);

CREATE TABLE Cartelera (
    idProducto int,
    fechaInicio date,
    cantidadSemanas int,
    FOREIGN KEY (idProducto) REFERENCES Producto(idProducto),
    PRIMARY KEY (idProducto)
);
